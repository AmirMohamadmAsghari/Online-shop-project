{% extends 'base.html' %}
{% load static %}
{% block title %}Home{% endblock %}
{% block style %}
<style>
    .jumbotron {
        background-image: url('banner.jpg');
        background-size: cover;
        color: #ffffff;
    }
    .card {
        border: none;
        transition: all 0.3s;
        height: 100%;
    }
    .card:hover {
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
    }
    .card-img-top {
        height: 200px;
        object-fit: cover;
    }
    .card-body {
        height: calc(100% - 200px);
        overflow: hidden;
    }
    .card-title {
        font-size: 1.2rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .card-text {
        font-size: 1rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock %}

{% block content %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}

<form action="{% url 'set_language' %}" method="post">
    {% csrf_token %}
    <select name="language" onchange="this.form.submit()">
        {% for language in languages %}
            <option value="{{ language.code }}" {% if language.code == LANGUAGE_CODE %}selected{% endif %}>
                {{ language.name_local }} ({{ language.code }})
            </option>
        {% endfor %}
    </select>
    <input type="hidden" name="next" value="{{ request.path }}">
</form>

<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <title>{% trans "Your Online Shop" %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% if LANGUAGE_CODE == 'fa' %}
    <link rel="stylesheet" href="{% static 'css/rtl.css' %}">
    {% endif %}
</head>
<body>
    <div class="container">
        <!-- Hero section -->
        <div class="jumbotron text-center" style="color: blanchedalmond">
            <h1 class="display-4" style="color: #343a40">{% trans "Welcome to Your Online Shop" %}</h1>
            <p class="lead" style="color: #343a40">{% trans "Find everything you need in one place." %}</p>
            <hr class="my-4">
        </div>

        <!-- Featured products -->
        <h2>{% trans "Discounted Products" %}</h2>
        <div class="row">
            {% for product in discounted_products %}
            <div class="col-md-4">
                <div class="card">
                    <img src="{{ product.ProductImages.first.image.url }}" class="card-img-top" alt="{{ product.title }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.title }}</h5>
                        <p class="card-text">${{ product.price }}</p>
                        <p class="card-text"><strong>{% trans "Discount" %}: </strong>{{ product.discount.amount }}%</p>
                        <p class="card-text"><strong>{% trans "Discount Type" %}: </strong>{{ product.discount.type }}</p>
                        <p class="card-text"><strong>{% trans "Expiration Date" %}: </strong>{{ product.discount.expiration_date }}</p>
                        <a href="{% url 'detail' product.id %}" class="btn btn-primary">{% trans "View Details" %}</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="pagination">
            <span class="step-links">
                {% if discounted_products.has_previous %}
                    <a href="?page=1">&laquo; {% trans "first" %}</a>
                    <a href="?page={{ discounted_products.previous_page_number }}">{% trans "previous" %}</a>
                {% endif %}

                <span class="current">
                    {% trans "Page" %} {{ discounted_products.number }} {% trans "of" %} {{ discounted_products.paginator.num_pages }}.
                </span>

                {% if discounted_products.has_next %}
                    <a href="?page={{ discounted_products.next_page_number }}">{% trans "next" %}</a>
                    <a href="?page={{ discounted_products.paginator.num_pages }}">{% trans "last" %} &raquo;</a>
                {% endif %}
            </span>
        </div>
    </div>

    <!-- Categories with Discounts -->
    <div class="container mt-5">
        <h2>{% trans "Categories with Discounts" %}</h2>
        <div class="row">
            {% for category in discounted_categories %}
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ category.name }}</h5>
                        <p class="card-text"><strong>{% trans "Discount" %}: </strong>{{ category.discount.amount }}%</p>
                        <p class="card-text">{% trans "Explore discounted products in the" %} {{ category.name }} {% trans "category." %}</p>
                        <a href="{% url "category-products" category.id %}" class="btn btn-primary">{% trans "Shop Now" %}</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>

<!-- Bootstrap JS (Optional) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}
